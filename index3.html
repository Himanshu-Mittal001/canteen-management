<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gurukul Canteen Management</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  <style>
    .student-image {
      width: 50px;
      height: 50px;
      border-radius: 50%;
    }

    .container {
      margin-top: 20px;
    }

    .button {
      background-color: #4CAF50;
      color: white;
      padding: 10px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      border-radius: 5px;
    }

    .button:hover {
      background-color: #45a049;
    }

    .form-group {
      margin-bottom: 10px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px;
      text-align: left;
      border: 1px solid #ddd;
    }

    th {
      background-color: #f4f4f4;
    }

  </style>
</head>

<body>

  <nav class="container-fluid">
    <ul>
      <li><strong>Gurukul Canteen Management</strong></li>
    </ul>
    <ul>
      <li><a href="#student-section">Students</a></li>
      <li><a href="#worker-section">Workers</a></li>
      <li><a href="#vendor-section">Vendors</a></li>
    </ul>
  </nav>

  <main class="container">
    
    <!-- Student Section -->
    <section id="student-section">
      <hgroup>
        <h2>Student Details</h2>
        <h3>Manage daily sales and transactions</h3>
      </hgroup>
      
      <!-- Add Student Form -->
      <form id="student-form">
        <div class="form-group">
          <label for="student-name">Student Name</label>
          <input type="text" id="student-name" name="student-name" placeholder="Student Name" required>
        </div>
        <div class="form-group">
          <label for="student-class">Class</label>
          <input type="text" id="student-class" name="student-class" placeholder="Class" required>
        </div>
        <div class="form-group">
          <label for="guardian-name">Guardian Name</label>
          <input type="text" id="guardian-name" name="guardian-name" placeholder="Guardian Name" required>
        </div>
        <div class="form-group">
          <label for="contact">Contact Number</label>
          <input type="tel" id="contact" name="contact" placeholder="Contact Number" required>
        </div>
        <div class="form-group">
          <label for="alternate-contact">Alternate Contact</label>
          <input type="tel" id="alternate-contact" name="alternate-contact" placeholder="Alternate Contact" required>
        </div>
        <div class="form-group">
          <label for="address">Address</label>
          <textarea id="address" name="address" placeholder="Address" required></textarea>
        </div>
        <div class="form-group">
          <label for="student-image">Student Image</label>
          <input type="file" id="student-image" name="student-image" accept="image/*" required>
        </div>
        <div class="form-group">
          <label for="debit-amount">Debit Amount</label>
          <input type="number" id="debit-amount" name="debit-amount" required>
        </div>
        <div class="form-group">
          <label for="credit-amount">Credit Amount</label>
          <input type="number" id="credit-amount" name="credit-amount" required>
        </div>
        <button type="submit" class="button">Add Student</button>
      </form>

      <!-- Display Student Profiles -->
      <h4>Student Transaction Records</h4>
      <table id="student-table">
        <thead>
          <tr>
            <th>Image</th>
            <th>Name</th>
            <th>Class</th>
            <th>Transaction Date</th>
            <th>Debit</th>
            <th>Credit</th>
            <th>Balance</th>
          </tr>
        </thead>
        <tbody>
          <!-- Data will be populated here dynamically -->
        </tbody>
      </table>
    </section>

    <!-- Worker Section -->
    <section id="worker-section">
      <hgroup>
        <h2>Worker Salary Records</h2>
        <h3>Track payments and salary distribution</h3>
      </hgroup>

      <!-- Add Worker Form -->
      <form id="worker-form">
        <div class="form-group">
          <label for="worker-name">Worker Name</label>
          <input type="text" id="worker-name" name="worker-name" placeholder="Worker Name" required>
        </div>
        <div class="form-group">
          <label for="worker-salary">Salary</label>
          <input type="number" id="worker-salary" name="worker-salary" placeholder="Salary" required>
        </div>
        <div class="form-group">
          <label for="amount-paid">Amount Paid</label>
          <input type="number" id="amount-paid" name="amount-paid" placeholder="Amount Paid" required>
        </div>
        <button type="submit" class="button">Add Worker</button>
      </form>

      <!-- Display Worker Records -->
      <div id="worker-records">
        <!-- Worker records will be added dynamically -->
      </div>
    </section>

    <!-- Vendor Section -->
    <section id="vendor-section">
      <hgroup>
        <h2>Vendor Purchase Records</h2>
        <h3>Track purchases and payments</h3>
      </hgroup>

      <!-- Add Vendor Form -->
      <form id="vendor-form">
        <div class="form-group">
          <label for="vendor-name">Vendor Name</label>
          <input type="text" id="vendor-name" name="vendor-name" placeholder="Vendor Name" required>
        </div>
        <div class="form-group">
          <label for="vendor-item">Item Purchased</label>
          <input type="text" id="vendor-item" name="vendor-item" placeholder="Item Purchased" required>
        </div>
        <div class="form-group">
          <label for="amount-paid-to-vendor">Amount Paid</label>
          <input type="number" id="amount-paid-to-vendor" name="amount-paid-to-vendor" placeholder="Amount Paid" required>
        </div>
        <button type="submit" class="button">Add Vendor</button>
      </form>

      <!-- Display Vendor Records -->
      <div id="vendor-records">
        <!-- Vendor records will be added dynamically -->
      </div>
    </section>

  </main>

  <footer class="container">
    <small><a href="#">Privacy Policy</a> â€¢ <a href="#">Terms of Service</a></small>
  </footer>

  <script>
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbxm4DbT6wQ4K31jWmy_xECP4Ne0DyfdQk_nJQXUTOeAvGe3rIZ9IYh3AF5Q02_Dw_QKLg/exec';

    // Handle Student Form submission
    document.getElementById('student-form').addEventListener('submit', async function (event) {
      event.preventDefault();

      const studentData = {
        name: document.getElementById('student-name').value,
        class: document.getElementById('student-class').value,
        guardian: document.getElementById('guardian-name').value,
        contact: document.getElementById('contact').value,
        address: document.getElementById('address').value,
        image: document.getElementById('student-image').files[0], // You need to handle file upload separately
        debitAmount: document.getElementById('debit-amount').value,
        creditAmount: document.getElementById('credit-amount').value,
        balance: calculateBalance(),
        transactionDate: new Date().toISOString().split('T')[0]
      };

      await fetch(scriptUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ sheet: 'Students', ...studentData })
      });

      fetchStudentRecords(); // Refresh the student table after submission
    });

    // Calculate balance
    function calculateBalance() {
      const debit = parseFloat(document.getElementById('debit-amount').value);
      const credit = parseFloat(document.getElementById('credit-amount').value);
      return debit - credit;
    }

    // Fetch Student Records from Google Sheets
    async function fetchStudentRecords() {
      const response = await fetch(`${scriptUrl}?sheet=Students`);
      const data = await response.json();
      const studentTable = document.getElementById('student-table').getElementsByTagName('tbody')[0];
      studentTable.innerHTML = '';

      data.forEach(student => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><img class="student-image" src="${student[6]}" alt="${student[1]}"></td>
          <td>${student[1]}</td>
          <td>${student[2]}</td>
          <td>${student[7]}</td>
          <td>${student[8]}</td>
          <td>${student[9]}</td>
          <td>${student[10]}</td>
        `;
        studentTable.appendChild(row);
      });
    }

    // Fetch data on page load
    fetchStudentRecords();
  </script>

</body>
</html>
