<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Canteen Management</title>
  <link href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" rel="stylesheet">
  <style>
    .student-image {
      width: 50px;
      height: 50px;
      border-radius: 50%;
    }
    table {
      width: 100%;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      text-align: left;
    }
    .button {
      background-color: #4CAF50;
      color: white;
      padding: 10px;
      border: none;
      cursor: pointer;
    }
    .button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <nav class="container-fluid">
    <ul>
      <li><strong>Canteen Management System</strong></li>
    </ul>
    <ul>
      <li><a href="#">Home</a></li>
      <li><a href="#students">Students</a></li>
      <li><a href="#workers">Workers</a></li>
      <li><a href="#vendors">Vendors</a></li>
    </ul>
  </nav>

  <main class="container">
    <section id="students">
      <hgroup>
        <h2>Student Transaction History</h2>
        <h3>View and Add Student Transactions</h3>
      </hgroup>

      <form id="student-form">
        <label for="student-name">Name</label>
        <input type="text" id="student-name" name="name" required>

        <label for="student-class">Class</label>
        <input type="text" id="student-class" name="class">

        <label for="student-guardian">Guardian</label>
        <input type="text" id="student-guardian" name="guardian">

        <label for="student-contact">Contact</label>
        <input type="text" id="student-contact" name="contact">

        <label for="student-address">Address</label>
        <input type="text" id="student-address" name="address">

        <label for="student-image">Student Image</label>
        <input type="file" id="student-image" name="image">

        <label for="debit-amount">Debit</label>
        <input type="number" id="debit-amount" name="debitAmount">

        <label for="credit-amount">Credit</label>
        <input type="number" id="credit-amount" name="creditAmount">

        <button class="button" type="submit">Add Transaction</button>
      </form>

      <table id="student-table">
        <thead>
          <tr>
            <th>Image</th>
            <th>Name</th>
            <th>Class</th>
            <th>Transaction Date</th>
            <th>Debit</th>
            <th>Credit</th>
            <th>Balance</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </section>

    <section id="workers">
      <hgroup>
        <h2>Worker Salary Management</h2>
      </hgroup>

      <form id="worker-form">
        <label for="worker-name">Name</label>
        <input type="text" id="worker-name" name="name" required>

        <label for="worker-salary-month">Salary Month</label>
        <input type="text" id="worker-salary-month" name="salaryMonth">

        <label for="worker-salary">Salary Amount</label>
        <input type="number" id="worker-salary" name="salaryAmount">

        <label for="worker-paid">Amount Paid</label>
        <input type="number" id="worker-paid" name="amountPaid">

        <button class="button" type="submit">Add Salary Record</button>
      </form>

      <table id="worker-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Salary Month</th>
            <th>Salary Amount</th>
            <th>Amount Paid</th>
            <th>Balance</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </section>

    <section id="vendors">
      <hgroup>
        <h2>Vendor Transaction History</h2>
      </hgroup>

      <form id="vendor-form">
        <label for="vendor-name">Name</label>
        <input type="text" id="vendor-name" name="name" required>

        <label for="goods-purchased">Goods Purchased</label>
        <input type="text" id="goods-purchased" name="goodsPurchased">

        <label for="amount-purchased">Amount of Goods</label>
        <input type="number" id="amount-purchased" name="amountPurchased">

        <label for="amount-paid">Amount Paid</label>
        <input type="number" id="amount-paid" name="amountPaid">

        <button class="button" type="submit">Add Vendor Record</button>
      </form>

      <table id="vendor-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Goods Purchased</th>
            <th>Amount Paid</th>
            <th>Amount of Goods</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </section>

    <section>
      <footer>
        <small>Powered by Canteen Management System</small>
      </footer>
    </section>

  </main>

  <script>
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbxm4DbT6wQ4K31jWmy_xECP4Ne0DyfdQk_nJQXUTOeAvGe3rIZ9IYh3AF5Q02_Dw_QKLg/exec';

    // Function to fetch student data
    async function fetchStudentData() {
      const response = await fetch(`${scriptUrl}?sheet=Students`);
      const data = await response.json();
      const studentTable = document.querySelector('#student-table tbody');
      
      // Clear existing table data
      studentTable.innerHTML = '';

      // Populate the table
      data.forEach((student) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><img class="student-image" src="${student[6]}" alt="${student[1]}"></td>
          <td>${student[1]}</td>
          <td>${student[2]}</td>
          <td>${student[7]}</td>
          <td>${student[8]}</td>
          <td>${student[9]}</td>
          <td>${student[10]}</td>
        `;
        studentTable.appendChild(row);
      });
    }

    document.getElementById("student-form").addEventListener("submit", async function(event) {
      event.preventDefault();
      const data = {
        id: Date.now(),
        name: document.getElementById("student-name").value,
        class: document.getElementById("student-class").value,
        guardian: document.getElementById("student-guardian").value,
        contact: document.getElementById("student-contact").value,
        address: document.getElementById("student-address").value,
        image: document.getElementById("student-image").files[0] ? URL.createObjectURL(document.getElementById("student-image").files[0]) : "",
        debitAmount: document.getElementById("debit-amount").value,
        creditAmount: document.getElementById("credit-amount").value,
        transactionDate: new Date().toLocaleDateString(),
        balance: document.getElementById("debit-amount").value - document.getElementById("credit-amount").value
      };

      // Call POST request to add student transaction
      const response = await fetch(scriptUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ sheet: 'Students', ...data })
      });

      if (response.ok) {
        fetchStudentData(); // Reload student data
      }
    });

    // Call fetchStudentData to load the data on page load
    fetchStudentData();
  </script>
</body>
</html>
