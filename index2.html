<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gurukul Canteen Management</title>
    <link href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" rel="stylesheet">
    <style>
        /* Basic CSS for styling */
        .student-image {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }

        .container {
            margin-top: 20px;
        }

        .button {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            border-radius: 5px;
        }

        .button:hover {
            background-color: #45a049;
        }

        .form-group {
            margin-bottom: 10px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        h2 {
            font-size: 28px;
            margin-bottom: 20px;
        }

        h3 {
            font-size: 18px;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
        }

        th {
            background-color: #f4f4f4;
        }

        .filter-date {
            margin-top: 20px;
        }

        .export-buttons {
            margin-top: 20px;
        }
    </style>
</head>

<body>

    <header class="container">
        <h1>Gurukul Canteen Management</h1>
        <p>Managing the Gurukul Database</p>
    </header>

    <main class="container">
        <!-- Student Section -->
        <section id="students">
            <hgroup>
                <h2>Student Transaction History</h2>
                <h3>Manage and View Student Data</h3>
            </hgroup>

            <!-- Add Student Form -->
            <form id="student-form">
                <div class="form-group">
                    <label for="student-name">Name</label>
                    <input type="text" id="student-name" name="name" required>
                </div>

                <div class="form-group">
                    <label for="student-class">Class</label>
                    <input type="text" id="student-class" name="class">
                </div>

                <div class="form-group">
                    <label for="student-guardian">Guardian</label>
                    <input type="text" id="student-guardian" name="guardian">
                </div>

                <div class="form-group">
                    <label for="student-contact">Contact</label>
                    <input type="text" id="student-contact" name="contact">
                </div>

                <div class="form-group">
                    <label for="student-address">Address</label>
                    <textarea id="student-address" name="address"></textarea>
                </div>

                <div class="form-group">
                    <label for="student-image">Student Image (URL)</label>
                    <input type="text" id="student-image" name="image">
                </div>

                <div class="form-group">
                    <label for="debit-amount">Debit</label>
                    <input type="number" id="debit-amount" name="debitAmount">
                </div>

                <div class="form-group">
                    <label for="credit-amount">Credit</label>
                    <input type="number" id="credit-amount" name="creditAmount">
                </div>

                <button class="button" type="submit">Add Transaction</button>
            </form>

            <!-- Filter Transactions by Date -->
            <div class="filter-date">
                <label for="date-filter-from">From:</label>
                <input type="date" id="date-filter-from">
                <label for="date-filter-to">To:</label>
                <input type="date" id="date-filter-to">
                <button class="button" onclick="filterTransactions()">Filter</button>
            </div>

            <!-- Table to Display Student Transactions -->
            <table id="student-table">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Class</th>
                        <th>Transaction Date</th>
                        <th>Debit</th>
                        <th>Credit</th>
                        <th>Balance</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be populated here dynamically -->
                </tbody>
            </table>

            <!-- Export Options -->
            <div class="export-buttons">
                <button class="button" onclick="exportToPDF()">Export to PDF</button>
                <button class="button" onclick="exportToExcel()">Export to Excel</button>
            </div>
        </section>

        <!-- Worker Section -->
        <section id="workers">
            <hgroup>
                <h2>Worker Salary Management</h2>
            </hgroup>

            <form id="worker-form">
                <div class="form-group">
                    <label for="worker-name">Name</label>
                    <input type="text" id="worker-name" name="name" required>
                </div>

                <div class="form-group">
                    <label for="worker-salary-month">Salary Month</label>
                    <input type="text" id="worker-salary-month" name="salaryMonth">
                </div>

                <div class="form-group">
                    <label for="worker-salary">Salary Amount</label>
                    <input type="number" id="worker-salary" name="salaryAmount">
                </div>

                <div class="form-group">
                    <label for="worker-paid">Amount Paid</label>
                    <input type="number" id="worker-paid" name="amountPaid">
                </div>

                <button class="button" type="submit">Add Salary Record</button>
            </form>

            <table id="worker-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Salary Month</th>
                        <th>Salary Amount</th>
                        <th>Amount Paid</th>
                        <th>Balance</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Worker data here -->
                </tbody>
            </table>
        </section>

        <!-- Vendor Section -->
        <section id="vendors">
            <hgroup>
                <h2>Vendor Transaction History</h2>
            </hgroup>

            <form id="vendor-form">
                <div class="form-group">
                    <label for="vendor-name">Name</label>
                    <input type="text" id="vendor-name" name="name" required>
                </div>

                <div class="form-group">
                    <label for="goods-purchased">Goods Purchased</label>
                    <input type="text" id="goods-purchased" name="goodsPurchased">
                </div>

                <div class="form-group">
                    <label for="amount-purchased">Amount of Goods</label>
                    <input type="number" id="amount-purchased" name="amountPurchased">
                </div>

                <div class="form-group">
                    <label for="amount-paid">Amount Paid</label>
                    <input type="number" id="amount-paid" name="amountPaid">
                </div>

                <button class="button" type="submit">Add Vendor Record</button>
            </form>

            <table id="vendor-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Goods Purchased</th>
                        <th>Amount Paid</th>
                        <th>Amount of Goods</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Vendor data here -->
                </tbody>
            </table>
        </section>

    </main>

    <footer class="container">
        <small>Powered by Gurukul Canteen Management System</small>
    </footer>

    <script>
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbxm4DbT6wQ4K31jWmy_xECP4Ne0DyfdQk_nJQXUTOeAvGe3rIZ9IYh3AF5Q02_Dw_QKLg/exec';

        // Function to fetch student data and display
        async function fetchStudentData() {
            const response = await fetch(`${scriptUrl}?sheet=Students`);
            const data = await response.json();
            const studentTable = document.querySelector('#student-table tbody');
            studentTable.innerHTML = '';  // Clear the table

            data.forEach((student) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><img class="student-image" src="${student[6]}" alt="${student[1]}"></td>
                    <td>${student[1]}</td>
                    <td>${student[2]}</td>
                    <td>${student[7]}</td>
                    <td>${student[8]}</td>
                    <td>${student[9]}</td>
                    <td>${student[10]}</td>
                `;
                studentTable.appendChild(row);
            });
        }

        document.getElementById("student-form").addEventListener("submit", async function (event) {
            event.preventDefault();

            const data = {
                id: Date.now(),
                name: document.getElementById("student-name").value,
                class: document.getElementById("student-class").value,
                guardian: document.getElementById("student-guardian").value,
                contact: document.getElementById("student-contact").value,
                address: document.getElementById("student-address").value,
                image: document.getElementById("student-image").value,
                debitAmount: document.getElementById("debit-amount").value,
                creditAmount: document.getElementById("credit-amount").value,
                transactionDate: new Date().toLocaleDateString(),
                balance: document.getElementById("debit-amount").value - document.getElementById("credit-amount").value
            };

            const response = await fetch(scriptUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ sheet: 'Students', ...data })
            });

            if (response.ok) {
                fetchStudentData(); // Reload student data
            }
        });

        // Export Data to PDF function
        function exportToPDF() {
            const doc = new jsPDF();
            doc.text('Student Transaction History', 10, 10);
            doc.autoTable({ html: '#student-table' });
            doc.save('student-transaction-history.pdf');
        }

        // Export Data to Excel function
        function exportToExcel() {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.table_to_sheet(document.getElementById('student-table'));
            XLSX.utils.book_append_sheet(wb, ws, 'Students');
            XLSX.writeFile(wb, 'student-transaction-history.xlsx');
        }

        // Load student data when the page loads
        fetchStudentData();
    </script>

    <!-- Include libraries for exporting to PDF and Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.1/xlsx.full.min.js"></script>

</body>

</html>
